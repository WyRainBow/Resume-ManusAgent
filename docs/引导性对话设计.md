# 引导性对话设计文档

## 0. 重要：原则而非脚本

**引导性对话不是"写死的对话模板"，而是一套交互原则。**

### 写死的脚本 vs 引导性原则

| 写死的脚本（错误） | 引导性原则（正确） |
|-------------------|------------------|
| 固定说"请告诉我您的需求，我将竭诚为您服务！" | 根据用户状态判断是否需要开场引导 |
| 固定说"接下来，我们先从最关键的【XXX】开始" | 分析当前情况，主动提出最合理的下一步 |
| 机械地每次都问"您同意这样优化吗？" | 在需要用户确认的关键节点才询问 |

### 实现方式：基于 Prompt 的原则式引导

在 System Prompt 中定义引导性对话的**原则和模式**，让 LLM 根据具体情况灵活运用。

**优势**：
- 不需要修改代码逻辑
- LLM 可以根据对话状态智能选择引导策略
- 容易迭代和优化

**实现位置**：`app/prompt/manus.py` 和 `app/prompt/cv_analyzer.py`

---

## 1. 设计理念

引导性对话的核心是**主动引导 + 寻求确认**，让用户感到被专业服务，同时保持控制权。

### 核心原则

1. **第一人称称呼** - 使用"您/你的"，建立亲和力
2. **主动提出方案** - 不等用户问，主动给出专业建议
3. **分步确认** - 每个重要操作前都征求用户同意
4. **清晰的选择** - 给出明确的回复选项（"可以"、"同意"、"好的"）
5. **流程透明** - 告诉用户下一步要做什么，为什么这样做

---

## 2. 对话模式分类

### 2.1 需求探询模式

**场景**：用户初次进入，需要了解用户需求

**模板**：
```
请告诉我您的需求，我将竭诚为您服务！

您想从哪个方面开始优化呢？
• 整体分析简历质量
• 优化某个具体模块
• 生成新的简历内容

或者我按照专业流程帮您系统性地优化一遍？
```

**关键要素**：
- 开场白（"竭诚为您服务"）
- 提供具体选项
- 提供专家建议（"专业流程"）

---

### 2.2 方案提案模式

**场景**：分析完问题后，提出解决方案

**模板**：
```
接下来，我们先从最关键的【内容整合与强化】开始，把您在腾讯云和深言科技的详细项目内容，整合到对应的工作经历下方，让HR一眼就能看到您在每段实习中的具体贡献。

您看可以吗？
```

**关键要素**：
- 说明"为什么"（"最关键的"、"让HR一眼看到"）
- 说明"怎么做"（"整合到对应工作经历下方"）
- 征求同意（"您看可以吗？"）

---

### 2.3 逐项确认模式

**场景**：需要用户提供信息或确认修改

**模板 A**：确认信息
```
我为您补充的教育经历中的GPA、专业排名、主修课程和荣誉奖项，是否需要修改？

如果您不记得精确数字，提供一个大概的范围或定性描述也可以。
```

**模板 B**：确认修改
```
您同意这样优化吗？
```

**模板 C**：请求补充
```
您能提供一些这样的信息吗？我来帮您润色。
```

**关键要素**：
- 具体化（列出"GPA、专业排名"等具体字段）
- 降低门槛（"大概的范围或定性描述也可以"）
- 主动协助（"我来帮您润色"）

---

### 2.4 模块确认模式

**场景**：完成一个模块后，确认下一步

**模板**：
```
您同意这样优化技能模块吗？

接下来，我将按照这个示例，为您补充教育经历。
```

**关键要素**：
- 确认当前模块
- 预告下一步（建立流程感）

---

### 2.5 结束引导模式

**场景**：报告结束，引导下一步行动

**模板**：
```
💡 我最推荐下一步：【深入分析简历，找出可以优化的地方】！

回复"开始优化"，我们马上开始！
```

**关键要素**：
- 视觉引导（💡 emoji）
- 明确行动号召（"回复'开始优化'"）
- 积极预期（"我们马上开始！"）

---

## 3. 引导句式库

### 开场引导

| 句式 | 使用场景 |
|------|----------|
| "请告诉我您的需求，我将竭诚为您服务！" | 初次问候 |
| "您想从哪个方面开始？" | 需求探询 |
| "或者我按照专业流程帮您系统性地优化一遍？" | 提供专家方案 |

### 方案提案

| 句式 | 使用场景 |
|------|----------|
| "接下来，我们先从最关键的【XXX】开始..." | 提出优先级 |
| "让HR一眼就能看到..." | 说明价值 |
| "您看可以吗？" | 征求同意 |

### 确认征询

| 句式 | 使用场景 |
|------|----------|
| "您同意这样优化吗？" | 确认修改 |
| "您同意这样补充吗？" | 确认新增 |
| "是否需要修改？" | 确认调整 |
| "您能提供一些这样的信息吗？" | 请求输入 |

### 流程预告

| 句式 | 使用场景 |
|------|----------|
| "接下来，我将..." | 下一步预告 |
| "按照这个示例，为您..." | 方法说明 |
| "我们先从...开始，然后..." | 流程规划 |

### 降低门槛

| 句式 | 使用场景 |
|------|----------|
| "如果您不记得精确数字，提供一个大概的范围或定性描述也可以。" | 降低精确度要求 |
| "我来帮您润色。" | 主动提供帮助 |
| "您看这样可以吗？" | 柔化确认 |

---

## 4. 提示词集成

### CV Analyzer 中的引导模式

**文件**：`app/prompt/cv_analyzer.py`

```python
OPTIMIZE_MODE_PROMPT = PromptTemplate.from_template("""## 简历优化分析

【目标模块】
{target_section}

【当前问题分析】
{current_issues}

【优化建议】
{optimization_suggestions}

━━━━━━━━━━━━━━━━━━━━━
💡 您同意这样优化吗？回复"可以"、"同意"或"好的"开始优化。
""")
```

### Manus 主 Agent 中的引导规范

**文件**：`app/prompt/manus.py`

```python
SYSTEM_PROMPT = """...
**Communication Style:**
- Use first person (I/your) when communicating with users
- Avoid using pure lists and bullet points format excessively
- Provide clear, actionable, and specific suggestions
- When providing optimization suggestions, end with "您同意这样优化吗？" or similar to ask for confirmation

**Optimization Workflow:**
- When user asks to optimize, first use cv_analyzer_agent to analyze and provide suggestions
- Present the suggestions to the user and ask for confirmation
- When user confirms ("可以", "同意", "好的", etc.), use cv_editor_agent to apply the changes
...
"""
```

---

## 5. 最佳实践示例

### 示例 1：完整优化流程

```
【AI】请告诉我您的需求，我将竭诚为您服务！
       您想从哪个方面开始优化？或者我按照专业流程帮您系统性地优化一遍？

【用户】帮我优化一下

【AI】好的！接下来，我们先从最关键的【内容整合与强化】开始，
       把您在腾讯云和深言科技的详细项目内容，整合到对应的工作经历下方，
       让HR一眼就能看到您在每段实习中的具体贡献。
       您看可以吗？

【用户】可以

【AI】已为您完成整合。接下来，我将优化您的技能模块，
       突出与目标岗位最相关的技能。您同意这样优化技能模块吗？

【用户】同意

【AI】技能模块已优化完成。最后，我为您补充教育经历中的详细信息。
       请告诉我，您还记得您的GPA和专业排名吗？如果不记得精确数字，
       提供一个大概的范围也可以。

【用户】GPA大概3.5以上，专业前20%

【AI】好的，我来帮您润色：GPA 3.5+/4.0，专业排名前20%。
       这样可以吗？
```

### 示例 2：引导用户提供信息

```
【AI】我注意到您的工作经历中缺少量化成果。
       比如"提升了系统性能"，如果能加上具体百分比会更有说服力。

       您能提供一些这样的信息吗？
       • 性能提升了多少百分比？
       • 处理了多少数据量？
       • 服务了多少用户？

       大概的数字也可以，我来帮您润色成专业的表述。

【用户】性能提升了50%左右

【AI】太好了！我建议这样写："通过优化数据库查询，将系统响应时间
       缩短了50%，日处理能力从10万请求提升到15万请求。"
       您同意这样改写吗？
```

---

## 6. 设计要点总结

| 要点 | 说明 | 示例 |
|------|------|------|
| **称呼** | 始终使用"您" | "您想从哪个方面开始？" |
| **主动** | 主动给出方案，不被动等待 | "接下来，我们先从..." |
| **解释** | 说明为什么这样做 | "让HR一眼就能看到..." |
| **确认** | 每步都征求意见 | "您看可以吗？" |
| **降低门槛** | 接受模糊信息，承诺润色 | "大概的范围也可以，我来帮您润色" |
| **积极结尾** | 鼓励性语言 + 明确行动号召 | "回复'开始优化'，我们马上开始！" |
| **视觉引导** | 使用 emoji 和分隔线 | 💡、━━━━━ |
| **分步进行** | 一次只做一件事，预告下一步 | "先从...开始，然后..." |

---

## 7. 实施检查清单

在新增或修改 Agent 提示词时，检查：

- [ ] 是否使用第一人称（"您/您的"）
- [ ] 是否主动给出具体建议
- [ ] 是否解释这样做的原因/价值
- [ ] 是否在重要操作前征求确认
- [ ] 是否给出明确的回复选项
- [ ] 是否降低用户输入门槛
- [ ] 是否有积极的行动号召
- [ ] 是否预告下一步计划
