# æ„å›¾è¯†åˆ«æœºåˆ¶

**æ–‡æ¡£ç‰ˆæœ¬**: 1.1
**æœ€åæ›´æ–°**: 2026-01-XX

## æ¦‚è¿°

OpenManus é‡‡ç”¨åŸºäº LLM çš„æ„å›¾è¯†åˆ«æ–¹æ¡ˆï¼Œæ›¿ä»£äº†åŸæœ‰çš„è§„åˆ™åˆ¤æ–­é€»è¾‘ã€‚ç³»ç»Ÿé€šè¿‡åˆ†æç”¨æˆ·è¾“å…¥ã€å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡ï¼Œå‡†ç¡®è¯†åˆ«ç”¨æˆ·æ„å›¾å¹¶è§¦å‘ç›¸åº”çš„å¤„ç†æµç¨‹ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**:
- åŸºäº LLM çš„è¯­ä¹‰ç†è§£ï¼Œè€Œéå…³é”®è¯åŒ¹é…
- ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼Œè€ƒè™‘å¯¹è¯å†å²
- ä¿¡æ¯æå–ï¼Œä¸ä»…åˆ†ç±»è¿˜æå–æ¨¡å—åã€é—®é¢˜ç¼–å·ç­‰
- ç½®ä¿¡åº¦è¯„ä¼°ï¼Œè¿”å›è¯†åˆ«ç½®ä¿¡åº¦
- æ¨ç†è¯´æ˜ï¼Œæä¾›è¯†åˆ«ç†ç”±ä¾¿äºè°ƒè¯•

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Manus Agent                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     think() æ–¹æ³•                          â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  1. è·å–ç”¨æˆ·è¾“å…¥                                           â”‚  â”‚
â”‚  â”‚         â”‚                                                 â”‚  â”‚
â”‚  â”‚         â–¼                                                 â”‚  â”‚
â”‚  â”‚  2. è°ƒç”¨ ConversationStateManager.process_input()         â”‚  â”‚
â”‚  â”‚         â”‚                                                 â”‚  â”‚
â”‚  â”‚         â–¼                                                 â”‚  â”‚
â”‚  â”‚  3. LLM æ„å›¾åˆ†ç±» â†’ è¿”å› (intent, tool, tool_args)        â”‚  â”‚
â”‚  â”‚         â”‚                                                 â”‚  â”‚
â”‚  â”‚         â–¼                                                 â”‚  â”‚
â”‚  â”‚  4. è·¯ç”±å†³ç­–                                              â”‚  â”‚
â”‚  â”‚     â”œâ”€ ç›´æ¥å·¥å…·è°ƒç”¨ â†’ _handle_direct_tool_call()          â”‚  â”‚
â”‚  â”‚     â”œâ”€ ç¡®è®¤å¤„ç† â†’ _handle_optimize_confirm()              â”‚  â”‚
â”‚  â”‚     â””â”€ LLM æµç¨‹ â†’ super().think()                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ConversationStateManager                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚        classify_intent_with_llm()                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - æ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - è°ƒç”¨ LLM è¿›è¡Œæ„å›¾åˆ†ç±»                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - è¿”å›æ„å›¾ + ç½®ä¿¡åº¦ + æå–ä¿¡æ¯                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ„å›¾ç±»å‹

| æ„å›¾ | è¯´æ˜ | è§¦å‘æ¡ä»¶ç¤ºä¾‹ | å¤„ç†æ–¹å¼ |
|------|------|--------------|----------|
| `greeting` | ç”¨æˆ·é—®å€™ | "ä½ å¥½"ã€"hi"ã€"hello" | è¿”å›é—®å€™è¯­ |
| `load_resume` | åŠ è½½ç®€å† | "åŠ è½½ç®€å†"ã€"ä¸Šä¼ ç®€å†" | è°ƒç”¨ cv_reader_agent |
| `view_resume` | æŸ¥çœ‹ç®€å† | "çœ‹çœ‹ç®€å†"ã€"ä»‹ç»ç®€å†" | è°ƒç”¨ cv_reader_agent |
| `analyze` | åˆ†æç®€å† | "åˆ†æç®€å†"ã€"è¯Šæ–­ç®€å†" | è°ƒç”¨ cv_analyzer_agent |
| `optimize` | æ•´ä½“ä¼˜åŒ– | "ä¼˜åŒ–ç®€å†" | å…ˆåˆ†æåä¼˜åŒ– |
| `optimize_section` | ä¼˜åŒ–ç‰¹å®šæ¨¡å— | "ä¼˜åŒ–å·¥ä½œç»å†"ã€"ä¼˜åŒ–ä¸ªäººæ€»ç»“" | åˆ†ææŒ‡å®šæ¨¡å— |
| `answer_question` | å›ç­”é—®é¢˜ | AI æé—®åçš„å›ç­” | æ”¶é›†ç­”æ¡ˆç”¨äºä¼˜åŒ– |
| `confirm` | ç¡®è®¤æ“ä½œ | "å¯ä»¥"ã€"å¥½çš„"ã€"ç¡®è®¤" | åº”ç”¨ä¼˜åŒ–å»ºè®® |
| `cancel` | å–æ¶ˆæ“ä½œ | "å–æ¶ˆ"ã€"ä¸è¦"ã€"ç®—äº†" | é‡ç½®çŠ¶æ€ |
| `unknown` | æœªçŸ¥æ„å›¾ | å…¶ä»–è¾“å…¥ | äº¤ç»™ LLM å¤„ç† |

## å·¥ä½œæµç¨‹

### 1. æ„å›¾è¯†åˆ«æµç¨‹

```
ç”¨æˆ·è¾“å…¥
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ„å»º LLM æç¤ºè¯                              â”‚
â”‚   - å¯¹è¯å†å²ï¼ˆæœ€è¿‘5æ¡ï¼‰                        â”‚
â”‚   - æœ€åä¸€æ¡ AI æ¶ˆæ¯                           â”‚
â”‚   - ç”¨æˆ·å½“å‰è¾“å…¥                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM åˆ†ç±»                                     â”‚
â”‚   - è¾“å‡ºï¼šæ„å›¾ç±»å‹ + ç½®ä¿¡åº¦                    â”‚
â”‚   - æå–ï¼šæ¨¡å—åã€é—®é¢˜ç¼–å·ã€å›ç­”ç±»å‹           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¿”å›ç»“æœ                                     â”‚
â”‚   {                                           â”‚
â”‚     "intent": Intent,                         â”‚
â”‚     "confidence": float,                      â”‚
â”‚     "extracted_info": {...},                  â”‚
â”‚     "reasoning": str                          â”‚
â”‚   }                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å†³ç­–è·¯ç”±æµç¨‹

```
æ„å›¾è¯†åˆ«ç»“æœ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åˆ¤æ–­ï¼šæ˜¯å¦æœ‰å»ºè®®å·¥å…·ï¼Ÿ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚ æ˜¯        â”‚ å¦
    â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ¤æ–­ï¼šæ˜¯å¦       â”‚   â”‚ åˆ¤æ–­ï¼šæ˜¯å¦éœ€è¦          â”‚
â”‚ ç›´æ¥å·¥å…·è°ƒç”¨ï¼Ÿ   â”‚   â”‚ å…ˆåŠ è½½ç®€å†ï¼Ÿ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚              â”‚
    â”‚ æ˜¯        â”‚ å¦            â”‚ æ˜¯ (ç®€å†æœªåŠ è½½)
    â–¼           â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ç›´æ¥è°ƒç”¨  â”‚   â”‚åˆ¤æ–­ï¼š â”‚   â”‚å…ˆåŠ è½½ç®€å†       â”‚
â”‚å·¥å…·      â”‚   â”‚ç¡®è®¤ï¼Ÿ â”‚   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ æ˜¯
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚åº”ç”¨ä¼˜åŒ–å»ºè®®   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸Šä¸‹æ–‡ä¼ é€’

### å¯¹è¯çŠ¶æ€ç®¡ç†

`ConversationStateManager` ç»´æŠ¤ä»¥ä¸‹çŠ¶æ€ï¼š

| å­—æ®µ | è¯´æ˜ |
|------|------|
| `state` | å½“å‰å¯¹è¯çŠ¶æ€ï¼ˆidle/greeting/analyzing/optimizing ç­‰ï¼‰ |
| `resume_loaded` | ç®€å†æ˜¯å¦å·²åŠ è½½ |
| `last_tool_used` | æœ€åä½¿ç”¨çš„å·¥å…· |
| `last_ai_response` | æœ€åä¸€æ¡ AI å“åº” |
| `optimization` | ä¼˜åŒ–æµç¨‹ä¸Šä¸‹æ–‡ï¼ˆæ¨¡å—ã€å½“å‰é—®é¢˜ã€ç­”æ¡ˆæ”¶é›†ï¼‰ |

### å†å²ä¼ é€’ç»™ LLM

æ„å›¾è¯†åˆ«æ—¶ä¼ é€’ç»™ LLM çš„ä¸Šä¸‹æ–‡ï¼š

1. **å¯¹è¯å†å²**ï¼šæœ€è¿‘ 5 æ¡æ¶ˆæ¯
2. **æœ€åä¸€æ¡ AI æ¶ˆæ¯**ï¼šç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯å›ç­”é—®é¢˜
3. **ç”¨æˆ·å½“å‰è¾“å…¥**ï¼šå¾…åˆ†ç±»çš„æ–‡æœ¬

## ç›´æ¥å·¥å…·è°ƒç”¨æœºåˆ¶

æŸäº›æ„å›¾ç»•è¿‡ LLM å†³ç­–ï¼Œç›´æ¥è°ƒç”¨å·¥å…·ï¼š

| æ¡ä»¶ | æ„å›¾ç±»å‹ | ç›®çš„ |
|------|----------|------|
| `should_use_tool_directly(intent) == True` | VIEW_RESUME, ANALYZE, OPTIMIZE ç­‰ | æé«˜å“åº”é€Ÿåº¦ï¼Œå‡å°‘ token æ¶ˆè€— |
| ç®€å†æœªåŠ è½½ + åˆ†ææ„å›¾ | ANALYZE, OPTIMIZE, OPTIMIZE_SECTION | è‡ªåŠ¨åŠ è½½é»˜è®¤ç®€å† |
| åˆšåº”ç”¨ä¼˜åŒ– | - | è‡ªåŠ¨ç»ˆæ­¢æµç¨‹ |

## ä¼˜åŒ–æµç¨‹ä¸­çš„é—®ç­”æ”¶é›†

å½“ç”¨æˆ·è¯·æ±‚ä¼˜åŒ–æ—¶ï¼Œç³»ç»Ÿå¯èƒ½éœ€è¦æ”¶é›†æ›´å¤šä¿¡æ¯ï¼š

```
ç”¨æˆ·: "ä¼˜åŒ–å·¥ä½œç»å†"
    â”‚
    â–¼
Analyzer åˆ†æå¹¶ç”Ÿæˆé—®é¢˜
    â”‚
    â–¼
é—®é¢˜1: "è¯·æè¿°æ‚¨çš„èŒè´£"
    â”‚
    â–¼
ç”¨æˆ·å›ç­” â†’ æ”¶é›†åˆ° answers
    â”‚
    â–¼
é—®é¢˜2: "è¯·æè¿°é¡¹ç›®æˆæœ"
    â”‚
    â–¼
ç”¨æˆ·å›ç­” â†’ æ”¶é›†åˆ° answers
    â”‚
    â–¼
é—®é¢˜3: "ä½¿ç”¨äº†å“ªäº›æŠ€æœ¯"
    â”‚
    â–¼
ç”¨æˆ·å›ç­” â†’ æ”¶é›†åˆ° answers
    â”‚
    â–¼
Editor åº”ç”¨ä¼˜åŒ–
```

## ä¸ LangChain çš„å¯¹æ¯”

### LangChain çš„æ„å›¾è¯†åˆ«æœºåˆ¶

LangChain **æ²¡æœ‰å†…ç½®çš„æ˜¾å¼æ„å›¾è¯†åˆ«æœºåˆ¶**ï¼Œè€Œæ˜¯é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ï¼š

1. **Agent ReAct Loop**: è®© LLM åœ¨æ¯æ¬¡å¾ªç¯ä¸­è‡ªä¸»å†³å®šï¼š
   - æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
   - è°ƒç”¨å“ªä¸ªå·¥å…·
   - å·¥å…·å‚æ•°æ˜¯ä»€ä¹ˆ

2. **å·¥å…·é€‰æ‹©**: é€šè¿‡ `tool_choice` å‚æ•°æ§åˆ¶ï¼š
   - `auto`: LLM è‡ªä¸»å†³å®šï¼ˆé»˜è®¤ï¼‰
   - `required`: å¿…é¡»è°ƒç”¨å·¥å…·
   - `none`: ä¸è°ƒç”¨å·¥å…·

3. **ä¸Šä¸‹æ–‡ç®¡ç†**: é€šè¿‡ Memory ç³»ç»Ÿä¿æŒå¯¹è¯å†å²ï¼ŒLLM åŸºäºå†å²è‡ªä¸»ç†è§£æ„å›¾

**LangChain çš„ä¼˜åŠ¿**:
- ç®€å•ç›´æ¥ï¼Œæ— éœ€é¢å¤–çš„æ„å›¾åˆ†ç±»æ­¥éª¤
- LLM è‡ªä¸»å†³ç­–ï¼Œçµæ´»æ€§é«˜
- å‡å°‘ä¸€æ¬¡ LLM è°ƒç”¨ï¼Œæ€§èƒ½æ›´å¥½

**LangChain çš„å±€é™**:
- æ— æ³•æ˜¾å¼æ§åˆ¶æ„å›¾è·¯ç”±
- æ— æ³•æå–ç»“æ„åŒ–ä¿¡æ¯ï¼ˆå¦‚æ¨¡å—åã€é—®é¢˜ç¼–å·ï¼‰
- æ— æ³•æä¾›æ„å›¾ç½®ä¿¡åº¦
- å·¥å…·é€‰æ‹©å¯èƒ½ä¸å¤Ÿç²¾ç¡®

### å½“å‰é¡¹ç›®çš„æ„å›¾è¯†åˆ«æœºåˆ¶

å½“å‰é¡¹ç›®å®ç°äº†**æ˜¾å¼æ„å›¾è¯†åˆ«**ï¼Œä½œä¸º LangChain çš„å¢å¼ºï¼š

1. **æ˜¾å¼æ„å›¾åˆ†ç±»**: åœ¨ Agent Loop ä¹‹å‰å…ˆè¿›è¡Œæ„å›¾è¯†åˆ«
2. **ç»“æ„åŒ–ä¿¡æ¯æå–**: ä¸ä»…åˆ†ç±»ï¼Œè¿˜æå–æ¨¡å—åã€é—®é¢˜ç¼–å·ç­‰
3. **æ™ºèƒ½è·¯ç”±**: æ ¹æ®æ„å›¾ç›´æ¥è°ƒç”¨å·¥å…·ï¼Œè·³è¿‡ LLM å†³ç­–ï¼ˆå¯é€‰ï¼‰
4. **çŠ¶æ€ç®¡ç†**: ç»“åˆ ConversationState è¿›è¡ŒçŠ¶æ€è·Ÿè¸ª

**å½“å‰é¡¹ç›®çš„ä¼˜åŠ¿**:
- æ„å›¾è¯†åˆ«æ›´ç²¾ç¡®ï¼Œæœ‰ç½®ä¿¡åº¦è¯„ä¼°
- å¯ä»¥æå–ç»“æ„åŒ–ä¿¡æ¯ï¼ˆsectionã€question ç­‰ï¼‰
- æ”¯æŒç›´æ¥å·¥å…·è°ƒç”¨ï¼Œå‡å°‘ token æ¶ˆè€—
- æ›´å¥½çš„çŠ¶æ€ç®¡ç†å’Œæµç¨‹æ§åˆ¶

**å½“å‰é¡¹ç›®çš„å±€é™**:
- éœ€è¦é¢å¤–çš„ LLM è°ƒç”¨ï¼ˆæ„å›¾è¯†åˆ«ï¼‰
- å¢åŠ ç³»ç»Ÿå¤æ‚åº¦
- éœ€è¦ç»´æŠ¤æ„å›¾ç±»å‹å®šä¹‰

### å¯¹æ¯”è¡¨

| ç‰¹æ€§ | LangChain | å½“å‰é¡¹ç›® | è¯´æ˜ |
|------|-----------|----------|------|
| **æ„å›¾è¯†åˆ«æ–¹å¼** | éšå¼ï¼ˆLLM è‡ªä¸»å†³ç­–ï¼‰ | æ˜¾å¼ï¼ˆLLM åˆ†ç±»ï¼‰ | å½“å‰é¡¹ç›®æ›´æ˜ç¡® |
| **å·¥å…·é€‰æ‹©** | LLM è‡ªä¸»å†³å®š | æ„å›¾é©±åŠ¨ + LLM å†³ç­– | å½“å‰é¡¹ç›®æ›´å¯æ§ |
| **ä¿¡æ¯æå–** | æ— ç»“æ„åŒ–æå– | æ”¯æŒï¼ˆsectionã€question ç­‰ï¼‰ | å½“å‰é¡¹ç›®æ›´ä¸°å¯Œ |
| **ç½®ä¿¡åº¦** | æ—  | æœ‰ï¼ˆ0.0-1.0ï¼‰ | å½“å‰é¡¹ç›®æ›´å¯é  |
| **æ€§èƒ½** | ä¸€æ¬¡ LLM è°ƒç”¨ | ä¸¤æ¬¡ LLM è°ƒç”¨ | LangChain æ›´å¿« |
| **çµæ´»æ€§** | é«˜ï¼ˆLLM è‡ªä¸»ï¼‰ | ä¸­ï¼ˆæ„å›¾é©±åŠ¨ï¼‰ | LangChain æ›´çµæ´» |
| **å¯ç»´æŠ¤æ€§** | é«˜ï¼ˆæ— éœ€ç»´æŠ¤æ„å›¾ï¼‰ | ä¸­ï¼ˆéœ€ç»´æŠ¤æ„å›¾ç±»å‹ï¼‰ | LangChain æ›´ç®€å• |
| **çŠ¶æ€ç®¡ç†** | åŸºç¡€ï¼ˆMemoryï¼‰ | å¢å¼ºï¼ˆState + Intentï¼‰ | å½“å‰é¡¹ç›®æ›´å®Œå–„ |

### è®¾è®¡å†³ç­–

å½“å‰é¡¹ç›®é€‰æ‹©æ˜¾å¼æ„å›¾è¯†åˆ«çš„åŸå› ï¼š

1. **ç®€å†ä¼˜åŒ–åœºæ™¯çš„ç‰¹æ®Šæ€§**:
   - éœ€è¦åŒºåˆ†"åˆ†æ"å’Œ"ä¼˜åŒ–"æ„å›¾
   - éœ€è¦è¯†åˆ«ä¼˜åŒ–å“ªä¸ªæ¨¡å—ï¼ˆå·¥ä½œç»å†ã€ä¸ªäººæ€»ç»“ç­‰ï¼‰
   - éœ€è¦è·Ÿè¸ªé—®ç­”æµç¨‹ï¼ˆé—®é¢˜1ã€é—®é¢˜2ã€é—®é¢˜3ï¼‰

2. **æ€§èƒ½ä¼˜åŒ–**:
   - æŸäº›æ„å›¾å¯ä»¥ç›´æ¥è°ƒç”¨å·¥å…·ï¼Œè·³è¿‡ LLM å†³ç­–
   - å‡å°‘ä¸å¿…è¦çš„ token æ¶ˆè€—

3. **ç”¨æˆ·ä½“éªŒ**:
   - æ›´ç²¾ç¡®çš„æ„å›¾è¯†åˆ«ï¼Œå‡å°‘è¯¯åˆ¤
   - æ›´å¿«çš„å“åº”é€Ÿåº¦ï¼ˆç›´æ¥å·¥å…·è°ƒç”¨ï¼‰

## ä¸æ—§ç‰ˆè§„åˆ™åˆ¤æ–­çš„å¯¹æ¯”

| ç‰¹æ€§ | è§„åˆ™åˆ¤æ–­ï¼ˆæ—§ç‰ˆï¼‰ | LLM æ„å›¾è¯†åˆ«ï¼ˆæ–°ç‰ˆï¼‰ |
|------|------------------|---------------------|
| è¯†åˆ«å‡†ç¡®ç‡ | ä¾èµ–å…³é”®è¯åŒ¹é…ï¼Œå®¹æ˜“è¯¯åˆ¤ | è¯­ä¹‰ç†è§£ï¼Œå‡†ç¡®ç‡é«˜ |
| ä¸Šä¸‹æ–‡æ„ŸçŸ¥ | ä»…å½“å‰è¾“å…¥ | ç»“åˆå¯¹è¯å†å² |
| æ‰©å±•æ€§ | æ·»åŠ æ–°æ„å›¾éœ€ä¿®æ”¹ä»£ç  | é€šè¿‡æç¤ºè¯é…ç½® |
| ç»´æŠ¤æˆæœ¬ | é«˜ï¼ˆ~300 è¡Œè§„åˆ™ä»£ç ï¼‰ | ä½ï¼ˆæç¤ºè¯é©±åŠ¨ï¼‰ |
| å¤„ç†é€Ÿåº¦ | å¿«ï¼ˆæœ¬åœ°åŒ¹é…ï¼‰ | ç¨æ…¢ï¼ˆLLM è°ƒç”¨ï¼‰ |

## å®é™…ä½¿ç”¨æƒ…å†µ

### é›†æˆä½ç½®

æ„å›¾è¯†åˆ«åœ¨ `Manus.think()` æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼š

```python
# app/agent/manus.py
async def think(self) -> bool:
    # è·å–ç”¨æˆ·è¾“å…¥
    user_input = self._get_last_user_input()

    # ğŸ§  ä½¿ç”¨ LLM æ„å›¾è¯†åˆ«
    intent_result = await self._conversation_state.process_input(
        user_input=user_input,
        conversation_history=self.memory.messages[-5:],
        last_ai_message=self._get_last_ai_message()
    )

    intent = intent_result["intent"]
    tool = intent_result.get("tool")
    tool_args = intent_result.get("tool_args", {})

    # æ ¹æ®æ„å›¾è¿›è¡Œè·¯ç”±å†³ç­–
    if tool and self._conversation_state.should_use_tool_directly(intent):
        # ç›´æ¥å·¥å…·è°ƒç”¨ï¼Œè·³è¿‡ LLM
        return await self._handle_direct_tool_call(tool, tool_args, intent)
    elif intent == Intent.CONFIRM:
        # ç¡®è®¤æ„å›¾ï¼Œåº”ç”¨ä¼˜åŒ–
        return await self._handle_optimize_confirm()
    else:
        # å…¶ä»–æƒ…å†µï¼Œç»§ç»­ LLM å†³ç­–æµç¨‹
        return await super().think()
```

### è·¯ç”±å†³ç­–é€»è¾‘

1. **ç›´æ¥å·¥å…·è°ƒç”¨**: æŸäº›æ„å›¾ï¼ˆVIEW_RESUMEã€ANALYZEã€OPTIMIZE ç­‰ï¼‰ç›´æ¥è°ƒç”¨å·¥å…·ï¼Œè·³è¿‡ LLM å†³ç­–
2. **ç¡®è®¤å¤„ç†**: CONFIRM æ„å›¾æ—¶ï¼Œä»å†å²æ¶ˆæ¯ä¸­æå–ä¼˜åŒ–å»ºè®®å¹¶åº”ç”¨
3. **LLM å†³ç­–**: å…¶ä»–æƒ…å†µç»§ç»­ä½¿ç”¨ LLM çš„ ReAct Loop

### æ€§èƒ½ä¼˜åŒ–

- **å‡å°‘ token æ¶ˆè€—**: ç›´æ¥å·¥å…·è°ƒç”¨æ—¶è·³è¿‡ LLM çš„ `think()` é˜¶æ®µ
- **æé«˜å“åº”é€Ÿåº¦**: æ— éœ€ç­‰å¾… LLM å†³ç­–ï¼Œç›´æ¥æ‰§è¡Œå·¥å…·
- **ä¿æŒçµæ´»æ€§**: å¤æ‚åœºæ™¯ä»ä½¿ç”¨ LLM å†³ç­–

## ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `app/agent/manus.py` | Manus Agentï¼Œé›†æˆæ„å›¾è¯†åˆ«ï¼ˆthink() æ–¹æ³•ï¼‰ |
| `app/memory/conversation_state.py` | æ„å›¾è¯†åˆ«å’ŒçŠ¶æ€ç®¡ç†ï¼ˆæ ¸å¿ƒå®ç°ï¼‰ |
| `app/memory/chat_history_manager.py` | å¯¹è¯å†å²ç®¡ç† |
| `app/schema.py` | Messageã€Intent ç­‰æ•°æ®æ¨¡å‹ |

## æ€»ç»“

å½“å‰é¡¹ç›®çš„æ„å›¾è¯†åˆ«æœºåˆ¶æ˜¯å¯¹ LangChain çš„å¢å¼ºï¼Œé€šè¿‡æ˜¾å¼æ„å›¾åˆ†ç±»å®ç°äº†ï¼š

1. âœ… **æ›´ç²¾ç¡®çš„æ„å›¾è¯†åˆ«**: åŸºäº LLM çš„è¯­ä¹‰ç†è§£
2. âœ… **ç»“æ„åŒ–ä¿¡æ¯æå–**: æå–æ¨¡å—åã€é—®é¢˜ç¼–å·ç­‰
3. âœ… **æ™ºèƒ½è·¯ç”±**: æ ¹æ®æ„å›¾ç›´æ¥è°ƒç”¨å·¥å…·ï¼Œä¼˜åŒ–æ€§èƒ½
4. âœ… **çŠ¶æ€ç®¡ç†**: ç»“åˆ ConversationState è¿›è¡Œæµç¨‹æ§åˆ¶

è™½ç„¶å¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦ï¼Œä½†åœ¨ç®€å†ä¼˜åŒ–è¿™ä¸ªç‰¹å®šåœºæ™¯ä¸‹ï¼Œæ˜¾å¼æ„å›¾è¯†åˆ«æä¾›äº†æ›´å¥½çš„æ§åˆ¶æ€§å’Œç”¨æˆ·ä½“éªŒã€‚
